// Псевдокод программы:
// 1. Инициализация: очистка экрана
// 2. Бесконечный цикл:
//    - Чтение состояния клавиатуры
//    - Проверка нажатых клавиш стрелок
//    - Если нажата LEFT: рисуем смайл в позиции (160,124)
//    - Если нажата UP: рисуем смайл в позиции (256,82)
//    - Если нажата RIGHT: рисуем смайл в позиции (336,124)
//    - Если нажата DOWN: рисуем смайл в позиции (256,165)
//    - Если нажата другая клавиша или нет нажатия: очищаем экран
//    - Возврат к началу цикла

(MAIN_LOOP)
    // Читаем состояние клавиатуры
    @KBD
    D=M
    
    // Проверяем LEFT (130)
    @130
    D=D-A
    @DRAW_LEFT
    D;JEQ
    
    // Восстанавливаем значение клавиатуры для следующей проверки
    @KBD
    D=M
    
    // Проверяем UP (131)
    @131
    D=D-A
    @DRAW_UP
    D;JEQ
    
    // Восстанавливаем значение клавиатуры для следующей проверки
    @KBD
    D=M
    
    // Проверяем RIGHT (132)
    @132
    D=D-A
    @DRAW_RIGHT
    D;JEQ
    
    // Восстанавливаем значение клавиатуры для следующей проверки
    @KBD
    D=M
    
    // Проверяем DOWN (133)
    @133
    D=D-A
    @DRAW_DOWN
    D;JEQ
    
    // Если дошли сюда - нажата другая клавиша или нет нажатия
    @CLEAR_SCREEN
    0;JMP

(DRAW_LEFT)
    // Устанавливаем координаты для LEFT: left=160, top=124
    @160
    D=A
    @0
    M=D        // R0 = left = 160
    
    @124
    D=A
    @1
    M=D        // R1 = top = 124
    
    @DRAW_SMILE
    0;JMP

(DRAW_UP)
    // Устанавливаем координаты для UP: left=256, top=82
    @256
    D=A
    @0
    M=D        // R0 = left = 256
    
    @82
    D=A
    @1
    M=D        // R1 = top = 82
    
    @DRAW_SMILE
    0;JMP

(DRAW_RIGHT)
    // Устанавливаем координаты для RIGHT: left=336, top=124
    @336
    D=A
    @0
    M=D        // R0 = left = 336
    
    @124
    D=A
    @1
    M=D        // R1 = top = 124
    
    @DRAW_SMILE
    0;JMP

(DRAW_DOWN)
    // Устанавливаем координаты для DOWN: left=256, top=165
    @256
    D=A
    @0
    M=D        // R0 = left = 256
    
    @165
    D=A
    @1
    M=D        // R1 = top = 165
    
    @DRAW_SMILE
    0;JMP

(CLEAR_SCREEN)
    // Очищаем экран - заполняем видеопамять нулями
    @SCREEN
    D=A
    @addr
    M=D        // addr = начальный адрес видеопамяти
    
    @8192      // 32K / 16 = 2048 слов? Нет, 512x256 = 8192 слов
    D=A
    @n
    M=D        // n = количество слов для очистки
    
(CLEAR_LOOP)
    @n
    D=M
    @END_CLEAR
    D;JEQ      // Если n == 0, выходим из цикла
    
    @addr
    A=M
    M=0        // Очищаем текущее слово
    
    @addr
    M=M+1      // Переходим к следующему слову
    
    @n
    M=M-1      // Уменьшаем счетчик
    
    @CLEAR_LOOP
    0;JMP

(END_CLEAR)
    @MAIN_LOOP
    0;JMP      // Возвращаемся в главный цикл

// ============ ПОДПРОГРАММА РИСОВАНИЯ СМАЙЛА ============
// Входные параметры:
// R0 = left (горизонтальная координата)
// R1 = top (вертикальная координата)
// Алгоритм: R0 = top * 32 + left / 16 → смещение в словах от начала видеопамяти

(DRAW_SMILE)
    // Сначала очищаем экран
    @CLEAR_SCREEN
    0;JMP

    // После очистки продолжаем рисовать смайл
    // Вычисляем смещение: R0 = top * 32 + left / 16
    @1
    D=M        // D = top
    @32
    D=D*A      // D = top * 32
    
    @0
    D=D+M      // D = top * 32 + left
    @16
    D=D/A      // D = (top * 32 + left) / 16
    
    @offset
    M=D        // Сохраняем вычисленное смещение
    
    // Вычисляем базовый адрес: base = 16384 + offset
    @16384
    D=A
    @offset
    D=D+M
    @base
    M=D        // Сохраняем base в RAM[base]

    // Рисуем смайл по 8 строкам:
    // Row 0-2: 0001110000111000 = 7224
    // Row 3-4: 0000000000000000 = 0
    // Row 5:   0110000000000110 = 24582
    // Row 6:   0011100000011100 = 14364
    // Row 7:   0000111111110000 = 4080

    // Строка 0: offset=0, value=7224
    @base
    D=M
    @0
    D=D+A
    @addr
    M=D        // addr = base + 0
    @7224
    D=A
    @addr
    A=M
    M=D

    // Строка 1: offset=32, value=7224
    @base
    D=M
    @32
    D=D+A
    @addr
    M=D        // addr = base + 32
    @7224
    D=A
    @addr
    A=M
    M=D

    // Строка 2: offset=64, value=7224
    @base
    D=M
    @64
    D=D+A
    @addr
    M=D        // addr = base + 64
    @7224
    D=A
    @addr
    A=M
    M=D

    // Строка 3: offset=96, value=0
    @base
    D=M
    @96
    D=D+A
    @addr
    M=D        // addr = base + 96
    @addr
    A=M
    M=0

    // Строка 4: offset=128, value=0
    @base
    D=M
    @128
    D=D+A
    @addr
    M=D        // addr = base + 128
    @addr
    A=M
    M=0

    // Строка 5: offset=160, value=24582
    @base
    D=M
    @160
    D=D+A
    @addr
    M=D        // addr = base + 160
    @24582
    D=A
    @addr
    A=M
    M=D

    // Строка 6: offset=192, value=14364
    @base
    D=M
    @192
    D=D+A
    @addr
    M=D        // addr = base + 192
    @14364
    D=A
    @addr
    A=M
    M=D

    // Строка 7: offset=224, value=4080
    @base
    D=M
    @224
    D=D+A
    @addr
    M=D        // addr = base + 224
    @4080
    D=A
    @addr
    A=M
    M=D

    // Возвращаемся в главный цикл
    @MAIN_LOOP
    0;JMP

(END)
    @END
    0;JMP      // Бесконечный цикл для завершения
